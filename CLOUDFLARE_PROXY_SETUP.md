# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare Worker –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è Supabase

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase —á–µ—Ä–µ–∑ Cloudflare Worker –¥–ª—è –æ–±—Ö–æ–¥–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

## –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

- ‚úÖ –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ Supabase –≤ –†–æ—Å—Å–∏–∏
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –¥–æ–º–µ–Ω api.syndikate-poker.ru
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ REST API, Realtime (WebSocket), Storage –∏ Edge Functions
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —Å–∫—Ä—ã—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –≤ Cloudflare

1. –ó–∞–π–¥–∏—Ç–µ –≤ **Cloudflare Dashboard** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º–µ–Ω **syndikate-poker.ru**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **DNS** ‚Üí **Records**
3. –î–æ–±–∞–≤—å—Ç–µ CNAME –∑–∞–ø–∏—Å—å:
   - **Type**: CNAME
   - **Name**: api
   - **Target**: –ü–æ–∫–∞ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (–∑–∞–ø–æ–ª–Ω–∏–º –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Worker)
   - **Proxy status**: üü† Proxied (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ)
   - **TTL**: Auto

## –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Cloudflare Worker

1. –í Cloudflare Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Workers & Pages**
2. –ù–∞–∂–º–∏—Ç–µ **Create Application** ‚Üí **Create Worker**
3. –ù–∞–∑–æ–≤–∏—Ç–µ Worker: `supabase-proxy`
4. –ù–∞–∂–º–∏—Ç–µ **Deploy** (–ø–æ–∫–∞ —Å –ø—É—Å—Ç—ã–º –∫–æ–¥–æ–º)

## –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ Worker

1. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Worker –Ω–∞–∂–º–∏—Ç–µ **Quick Edit**
2. **–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç–µ** –≤–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `cloudflare-worker-proxy.js` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥** –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
5. **–í—Å—Ç–∞–≤—å—Ç–µ** –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä Worker
6. –ù–∞–∂–º–∏—Ç–µ **Save and Deploy**

## –®–∞–≥ 4: –ü—Ä–∏–≤—è–∑–∫–∞ Custom Domain

1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Worker –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Triggers**
2. –í —Ä–∞–∑–¥–µ–ª–µ **Custom Domains** –Ω–∞–∂–º–∏—Ç–µ **Add Custom Domain**
3. –í–≤–µ–¥–∏—Ç–µ: `api.syndikate-poker.ru`
4. –ù–∞–∂–º–∏—Ç–µ **Add Custom Domain**
5. Cloudflare –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω—É–∂–Ω—É—é DNS –∑–∞–ø–∏—Å—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: DNS –∑–∞–ø–∏—Å—å —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!

## –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CNAME –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–ª–∏ –≤—Ä—É—á–Ω—É—é)

–ï—Å–ª–∏ –≤—ã —Å–æ–∑–¥–∞–ª–∏ CNAME –∑–∞–ø–∏—Å—å –Ω–∞ –®–∞–≥–µ 1, –æ–±–Ω–æ–≤–∏—Ç–µ –µ—ë:
1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ **DNS** ‚Üí **Records**
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø–∏—Å—å `api`
3. –ò–∑–º–µ–Ω–∏—Ç–µ **Target** –Ω–∞: `supabase-proxy.–í–ê–®-–ê–ö–ö–ê–£–ù–¢.workers.dev`
   (–∑–∞–º–µ–Ω–∏—Ç–µ `–í–ê–®-–ê–ö–ö–ê–£–ù–¢` –Ω–∞ –≤–∞—à subdomain Cloudflare Workers)
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ **Proxy status** = üü† Proxied

## –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://api.syndikate-poker.ru/rest/v1/`
2. –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON –æ—Ç–≤–µ—Ç –æ—Ç Supabase

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl:

```bash
curl -i https://api.syndikate-poker.ru/rest/v1/ \
  -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1va2hzc21ub3JyaG9ocm93eHZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwODUzNDYsImV4cCI6MjA2ODY2MTM0Nn0.ZWYgSZFeidY0b_miC7IyfXVPh1EUR2WtxlEvt_fFmGc"
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å `200 OK`.

## –®–∞–≥ 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (–£–ñ–ï –°–î–ï–õ–ê–ù–û)

‚úÖ –§–∞–π–ª `src/integrations/supabase/client.ts` —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
```typescript
const SUPABASE_URL = "https://api.syndikate-poker.ru";
```

## –ß—Ç–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è?

Worker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

1. **REST API** (`/rest/v1/*`) - –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. **Realtime** (`/realtime/v1/*`) - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. **Storage** (`/storage/v1/*`) - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
4. **Edge Functions** (`/functions/v1/*`) - —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
5. **Auth** (`/auth/v1/*`) - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Worker

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
1. –í Worker ‚Üí **Logs** ‚Üí **Begin log stream**
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è
3. –õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—à–∏–±–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏:
1. Worker ‚Üí **Metrics**
2. –°–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—à–∏–±–∫–∏, –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. "Failed to fetch" –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–ü—Ä–∏—á–∏–Ω–∞**: Worker –µ—â–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ DNS –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ**: 
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Custom Domain –¥–æ–±–∞–≤–ª–µ–Ω –≤ Worker
- –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Del)

### 2. "Invalid API key"

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ–¥ Worker —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞

### 3. Realtime –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞**: WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Worker –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç WebSocket (–µ—Å—Ç—å –≤ –∫–æ–¥–µ)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Cloudflare –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç WebSocket:
  - Dashboard ‚Üí Network ‚Üí WebSockets ‚Üí Enabled

### 4. –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–ü—Ä–∏—á–∏–Ω–∞**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π hop —á–µ—Ä–µ–∑ Cloudflare

**–†–µ—à–µ–Ω–∏–µ**: 
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∑–∞–¥–µ—Ä–∂–∫–∞ +10-50ms
- Cloudflare –∫–µ—à–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å Argo Smart Routing (–ø–ª–∞—Ç–Ω–∞—è –æ–ø—Ü–∏—è)

## –°—Ç–æ–∏–º–æ—Å—Ç—å

**–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω Cloudflare Workers:**
- ‚úÖ –î–æ 100,000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- ‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ Custom Domains
- ‚úÖ WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!

## –û—Ç–∫–∞—Ç –Ω–∞–∑–∞–¥ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `src/integrations/supabase/client.ts`
2. –ò–∑–º–µ–Ω–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ:
```typescript
const SUPABASE_URL = "https://mokhssmnorrhohrowxvu.supabase.co";
```
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP:

–î–æ–±–∞–≤—å—Ç–µ –≤ Worker –ø–µ—Ä–µ–¥ `try {`:

```javascript
// –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –†–æ—Å—Å–∏–∏
const country = request.cf.country;
if (country !== 'RU') {
  return new Response('Access denied', { status: 403 });
}
```

### Rate Limiting:

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloudflare Rate Limiting:
1. Dashboard ‚Üí Security ‚Üí WAF ‚Üí Rate limiting rules
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è `api.syndikate-poker.ru`
3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω —Å –æ–¥–Ω–æ–≥–æ IP

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –≤ DevTools –±—Ä–∞—É–∑–µ—Ä–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ DNS –æ–±–Ω–æ–≤–∏–ª—Å—è: `nslookup api.syndikate-poker.ru`
