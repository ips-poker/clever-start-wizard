# Настройка Telegram авторизации

## Описание
Теперь пользователи могут авторизоваться на сайте двумя способами:
1. **Email и пароль** - стандартная регистрация
2. **Через Telegram** - быстрая авторизация без создания пароля

## Как это работает

### Для пользователей:
1. На странице авторизации (`/auth`) появилась кнопка "Войти через Telegram"
2. При нажатии откроется Telegram бот
3. Пользователь нажимает "Старт" в боте
4. Автоматически создается аккаунт и происходит вход на сайт

### Техническая реализация:
1. **TelegramLoginWidget** - компонент кнопки авторизации
2. **telegram-auth edge function** - обрабатывает данные Telegram и создает пользователя
3. **Обновленный telegram-webhook** - поддерживает команды веб-авторизации
4. **useTelegramAuth хук** - управляет состоянием авторизации

## Настройка бота

### 1. Создание бота (если еще не создан)
1. Напишите @BotFather в Telegram
2. Отправьте `/newbot`
3. Выберите имя бота (например: "EPC Poker Bot")
4. Выберите username бота (например: "EPC_Poker_Bot")
5. Сохраните токен бота

### 2. Настройка домена для Login Widget
1. Напишите @BotFather
2. Отправьте `/mybots`
3. Выберите своего бота
4. Нажмите "Bot Settings" → "Domain"
5. Добавьте ваш домен (например: `epc-poker.ru`)

### 3. Настройка Webhook (уже настроено)
Webhook уже настроен в Supabase edge functions и обрабатывает:
- Обычные сообщения
- Команды веб-авторизации
- Статистику пользователей

### 4. Обновление кода (если нужно изменить имя бота)
В файлах нужно заменить `'EPC_Poker_Bot'` на имя вашего бота:
- `src/components/auth/TelegramLoginWidget.tsx`
- `src/hooks/useTelegramAuth.ts`

## Безопасность
- Все данные проверяются через официальный API Telegram
- Создаются уникальные email адреса для Telegram пользователей
- Используется Supabase Auth для управления сессиями
- Автоматически создаются профили игроков

## Структура данных
Для Telegram пользователей создается:
- **User в Supabase Auth** с метаданными Telegram
- **Profile в таблице profiles** с базовой информацией
- **Player в таблице players** для участия в турнирах

## Тестирование
1. Откройте `/auth` на сайте
2. Нажмите "Войти через Telegram" 
3. В Telegram боте нажмите "Авторизоваться на сайте"
4. Должен произойти автоматический вход на сайт

## Поддержка
Если возникают проблемы:
1. Проверьте, что бот настроен правильно в @BotFather
2. Убедитесь, что домен добавлен в настройках бота
3. Проверьте переменные окружения в Supabase (TELEGRAM_BOT_TOKEN)
4. Посмотрите логи edge functions в Supabase Dashboard